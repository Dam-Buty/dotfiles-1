#!/bin/bash

tmpFile=`mktemp`

arg1=$1
arg2=$2

isRecursive=0

if [ "$arg1" == "-h" ]; then
  echo "usage: watch-files [options] <file> < stdin"
  exit 0
elif [ "$arg1" == "-r" ]; then
  isRecursive=1
  toWatch=$arg2
else
  toWatch=$arg1
fi

echo $toWatch

function cleanup {
  rm $tmpFile
}

trap cleanup EXIT

while read line
do
  echo $line >> $tmpFile
done < /dev/stdin

bash $tmpFile

if [ "$isRecursive" == "1" ]; then
  while inotifywait --quiet --quiet -e close_write -r $toWatch; do
    bash $tmpFile
  done
else
  while inotifywait --quiet --quiet -e close_write $toWatch; do
    bash $tmpFile
  done
fi
